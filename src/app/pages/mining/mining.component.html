<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Mining</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <ul class="nav nav-pills m-3" id="pills-tab" role="tablist">
      @for(navbarLink of links; track navbarLink.name) {
        <li class="nav-item mr-2" role="presentation">
            <button [class]="navbarLink.selected ? 'nav-link active btn-sm' : 'nav-link btn-sm'" [id]="navbarLink.id" data-bs-toggle="pill" [attr.data-bs-target]="navbarLink.target" type="button" role="tab" [attr.aria-controls]="navbarLink.controls" [attr.aria-selected]="navbarLink.selected" [disabled]="navbarLink.disabled">{{navbarLink.name}}</button>
        </li>
      }
    </ul>
  </div>
</div>

<div *ngIf="daemonRunning && !daemonStopping" class="tab-content tab-grow" id="pills-tabContent">

  <div class="tab-pane fade show active" id="pills-mining-status" role="tabpanel" aria-labelledby="pills-mining-status-tab" tabindex="0">
    <div class="btn-toolbar mb-2 mb-md-0">
      <ul class="nav nav-pills m-3" id="pills-tab" role="tablist">
        
        <li class="nav-item mr-2" role="presentation">
          <button [class]="currentDashboardTab === 'overview' ? 'nav-link active btn-sm' : 'nav-link btn-sm'" id="miningOverviewLink" data-bs-toggle="pill" type="button" role="tab" (click)="setCurrentDashboardTab('overview')">Overview</button>
        </li>
        
        <li class="nav-item mr-2" role="presentation">
          <button [class]="currentDashboardTab === 'p2pool' ? 'nav-link active btn-sm' : 'nav-link btn-sm'" id="miningP2PoolLink" data-bs-toggle="pill" type="button" role="tab" (click)="setCurrentDashboardTab('p2pool')">P2Pool</button>
        </li>

      </ul>
    </div>

    <div class="card p-1" [hidden]="currentDashboardTab !== 'overview'">
      
      <div *ngIf="coreBusy" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          Mining is not available, node is not synchronized
        </div>
      </div>

      <div *ngIf="startMiningError !== ''" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          {{ startMiningError }}
        </div>
      </div>

      <div class="card-header bg-primary text-white d-flex">
        <h4><i class="bi bi-speedometer2"></i>&nbsp;&nbsp;Dashboard</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4">
              <h6>Status</h6>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-state-info">State</span>
                <input type="text" class="form-control" aria-label="State" aria-describedby="mining-state-info" [value]="miningState" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-type-info">Type</span>
                <input type="text" class="form-control" aria-label="Type" aria-describedby="mining-type-info" [value]="miningType" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-pow-alg-info">PoW Algorithm</span>
                <input type="text" class="form-control" aria-label="PoW Algorithm" aria-describedby="mining-pow-alg-info" [value]="powAlgorithm" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-speed-info">Speed</span>
                <input type="text" class="form-control" aria-label="Speed" aria-describedby="net-proxy-info" [value]="miningSpeed" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-threads-count-info">Threads Count</span>
                <input type="text" class="form-control" aria-label="Threads Count" aria-describedby="mining-threads-count-info" [value]="miningThreadsCount" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-daily-income-info">Est. Daily Income</span>
                <input type="text" class="form-control" aria-label="Daily Income" aria-describedby="mining-daily-income-info" [value]="estimatedDailyIncome" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-time-next-block-info">Est. Time to Find Next Block</span>
                <input type="text" class="form-control" aria-label="Est. Time to Find Next Block" aria-describedby="mining-time-next-block-info" [value]="timeToFindBlock" readonly>
              </div>

          </div>

          <div class="col-md-4">
              <h6>Background Mining</h6>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-bg-enabled-info">Status</span>
                <input type="text" class="form-control" aria-label="Upload" aria-describedby="mining-bg-enabled-info" [value]="miningBgEnabled" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-bg-idle-threshold-info">Idle Threshold</span>
                <input type="text" class="form-control" aria-label="Idle Threshold" aria-describedby="mining-bg-idle-threshold-info" [value]="miningBgIdleThreshold" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-bg-min-idle-seconds-info">Min Idle Seconds</span>
                <input type="text" class="form-control" aria-label="Min Idle Seconds" aria-describedby="mining-bg-min-idle-seconds-info" [value]="miningBgMinIdleSeconds" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-bg-target-info">Target</span>
                <input type="text" class="form-control" aria-label="Target" aria-describedby="mining-bg-target-info" [value]="miningBgTarget" readonly>
              </div>

          </div>

          <div class="col-md-4">
              <h6>Network</h6>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-net-hashrate-info">Hashrate</span>
                <input type="text" class="form-control" aria-label="Hashrate" aria-describedby="mining-net-hashrate-info" [value]="networkHashRate" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-difficulty-info">Difficulty</span>
                <input type="text" class="form-control" aria-label="Difficulty" aria-describedby="mining-difficulty-info" [value]="miningDifficulty" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-height-info">Block Height</span>
                <input type="text" class="form-control" aria-label="Block Height" aria-describedby="mining-height-info" [value]="miningHeight" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-reward-info">Block Reward</span>
                <input type="text" class="form-control" aria-label="Block Reward" aria-describedby="mining-reward-info" [value]="miningBlockReward" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-target-info">Block Target</span>
                <input type="text" class="form-control" aria-label="Block Target" aria-describedby="mining-target-info" [value]="miningBlockTarget" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-md-block-info">Median Block Weight</span>
                <input type="text" class="form-control" aria-label="Block Weight" aria-describedby="mining-md-block-info" [value]="miningMedBlockWeight" readonly>
              </div>

          </div>

          <div class="col-md-12" [hidden]="!miningStatus || !miningStatus.active">
              <div class="input-group mb-1">
                <span class="input-group-text" id="mining-address-info">Mining on Address</span>
                <input type="text" class="form-control" aria-label="Mining on Address" aria-describedby="mining-address-info" [value]="startMiningMinerAddress" readonly>
              </div>
          </div>

        </div>

        <div *ngIf="!coreBusy && !stoppingMining && miningStatus && !miningStatus.active" class="row g-5 p-3">
          <div class="col-md-12 col-lg-12">
            <div class="row gy-3">
              <h4 class="mb-3">Start mining</h4>
              
              <div class="col-sm-12">
                <label for="start-mining-miner-address" class="form-label">Miner Address</label>
                <input type="text" class="form-control" id="start-mining-miner-address" placeholder="" [(ngModel)]="startMiningMinerAddress" [ngModelOptions]="{standalone: true}">
                <small class="text-body-secondary">Account address to mine to</small>
              </div>

              <div class="col-md-4">
                <label for="check-updates" class="form-label">Type</label>
                <select class="form-select" id="log-level" [(ngModel)]="startMiningType" [ngModelOptions]="{standalone: true}">
                  <option [ngValue]="'solo-mining'">Solo Mining</option>
                  <option [ngValue]="'p2pool-main'">P2Pool (Main)</option>
                  <option [ngValue]="'p2pool-mini'">P2Pool (Mini)</option>
                </select>
                <br>
                <small class="text-body-secondary">
                  Mining typology
                </small>
              </div>

              <div class="col-sm-4">
                <label for="start-mining-threads-count" class="form-label">Threads Count</label>
                <input type="number" min="0" class="form-control" id="start-mining-threads-count" placeholder="" [(ngModel)]="startMiningThreadsCount" [ngModelOptions]="{standalone: true}">
                <small class="text-body-secondary">Number of mining thread to run</small>
              </div>

              <div class="form-check form-switch col-md-6">
                <label for="start-mining-do-background-mining" class="form-check-label">Do Background Mining</label>
                <input class="form-control form-check-input" type="checkbox" role="switch" id="start-mining-do-background-mining" [disabled]="startMiningType !== 'solo-mining'" [checked]="startMiningDoBackgroundMining && startMiningType === 'solo-mining'" [(ngModel)]="startMiningDoBackgroundMining" [ngModelOptions]="{standalone: true}">
                <br>
                <small class="text-body-secondary">States if the mining should run in background (true) or foreground (false)</small>
              </div>
              
              <div class="form-check form-switch col-md-6">
                <label for="start-mining-ignore-battery" class="form-check-label">Ignore Battery</label>
                <input class="form-control form-check-input" type="checkbox" role="switch" id="start-mining-ignore-battery" [disabled]="startMiningType !== 'solo-mining'" [checked]="startMiningIgnoreBattery && startMiningType === 'solo-mining'" [(ngModel)]="startMiningIgnoreBattery" [ngModelOptions]="{standalone: true}">
                <br>
                <small class="text-body-secondary">States if battery state (on laptop) should be ignored (true) or not (false)</small>
              </div>

            </div>
          </div>
        </div>

        <hr *ngIf="!coreBusy" class="my-4">

        <button *ngIf="!coreBusy && !stoppingMining && !startingMining && (!miningStatus || !miningStatus.active)" class="w-100 btn btn-primary btn-lg" type="button" (click)="startMining()" [disabled]="!validStartMiningMinerAddress"><i class="bi bi-play-fill"></i>&nbsp;&nbsp;Start Mining</button>
        <button *ngIf="!coreBusy && !stoppingMining && startingMining && (!miningStatus || !miningStatus.active)" class="w-100 btn btn-primary btn-lg" type="button" disabled>Starting Mining ...</button>

        <button *ngIf="!coreBusy && !stoppingMining && !startingMining && miningStatus && miningStatus.active" class="w-100 btn btn-primary btn-lg" type="button" (click)="stopMining()"><i class="bi bi-stop-fill"></i>&nbsp;&nbsp;Stop Mining</button>
        <button *ngIf="!coreBusy && stoppingMining && !startingMining && miningStatus" class="w-100 btn btn-primary btn-lg" type="button" disabled><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Stopping Mining ...</button>

      </div>
    </div>

    <div class="card p-1" [hidden]="currentDashboardTab !== 'p2pool'">
      <div class="card-header bg-primary text-white d-flex">
        <h4><i class="bi bi-diagram-3"></i>&nbsp;&nbsp;P2Pool</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4">
              <h6>Status</h6>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-state-info">State</span>
                <input type="text" class="form-control" aria-label="State" aria-describedby="p2pool-state-info" [value]="p2poolState" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-pool-info">Pool</span>
                <input type="text" class="form-control" aria-label="Pool" aria-describedby="p2pool-pool-info" [value]="p2poolPool" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-current-hashrate-info">Current Hashrate</span>
                <input type="text" class="form-control" aria-label="Current Hashrate" aria-describedby="p2pool-current-hashrate-info" [value]="p2poolCurrentHashrate" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-total-hashes-info">Total Hashes</span>
                <input type="text" class="form-control" aria-label="Total Hashes" aria-describedby="p2pool-total-hashes-info" [value]="p2poolTotalHashes" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-shares-found-info">Shares Found</span>
                <input type="text" class="form-control" aria-label="Shares Found" aria-describedby="p2pool-shares-found-info" [value]="p2poolSharesFound" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-shares-failed-info">Shares Failed</span>
                <input type="text" class="form-control" aria-label="Shares Failed" aria-describedby="p2pool-shares-failed-info" [value]="p2poolSharesFailed" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-reward-share-info">Block Reward Share</span>
                <input type="text" class="form-control" aria-label="Block Reward Share" aria-describedby="p2pool-reward-share-info" [value]="p2poolRewardShare" readonly>
              </div>

          </div>

          <div class="col-md-4">
              <h6>Info</h6>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-hashrate-15m-info">Hashrate 15m</span>
                <input type="text" class="form-control" aria-label="Hashrate 15m" aria-describedby="p2pool-hashrate-15m-info" [value]="p2poolHashrate15m" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-hashrate-1h-info">Hashrate 1h</span>
                <input type="text" class="form-control" aria-label="Hashrate 1h" aria-describedby="p2pool-hashrate-1h-info" [value]="p2poolHashrate1h" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-hashrate-24h-info">Hashrate 24h</span>
                <input type="text" class="form-control" aria-label="Hashrate 24h" aria-describedby="p2pool-hashrate-24h-info" [value]="p2poolHashrate24h" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-current-effort-info">Current Effort</span>
                <input type="text" class="form-control" aria-label="Current Effort" aria-describedby="p2pool-current-effort-info" [value]="p2poolCurrentEffort" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-average-effort-info">Average Effort</span>
                <input type="text" class="form-control" aria-label="Average Effort" aria-describedby="p2pool-average-effort-info" [value]="p2poolAverageEffort" readonly>
              </div>

          </div>

          <div class="col-md-4">
              <h6>Pool Statistics</h6>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-hashrate-info">Hashrate</span>
                <input type="text" class="form-control" aria-label="Hashrate" aria-describedby="p2pool-hashrate-info" [value]="p2poolHashrate" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-side-chain-difficulty-info">Side Chain Difficulty</span>
                <input type="text" class="form-control" aria-label="Side Chain Difficulty" aria-describedby="p2pool-side-chain-difficulty-info" [value]="p2poolSidechainDifficulty" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-side-chain-height-info">Side Chain Height</span>
                <input type="text" class="form-control" aria-label="Side Chain Height" aria-describedby="p2pool-side-chain-height-info" [value]="p2poolSidechainHeight" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-miners-info">Miners</span>
                <input type="text" class="form-control" aria-label="Miners" aria-describedby="p2pool-miners-info" [value]="p2poolMiners" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-total-hashes-info">Total Hashes</span>
                <input type="text" class="form-control" aria-label="Total Hashes" aria-describedby="p2pool-total-hashes-info" [value]="p2poolPoolTotalHashes" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-last-block-found-info">Last Block Found</span>
                <input type="text" class="form-control" aria-label="Last Block Found" aria-describedby="p2pool-last-block-found-info" [value]="p2poolLastBlockFound" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-total-blocks-found-info">Total Blocks Found</span>
                <input type="text" class="form-control" aria-label="Total Blocks Found" aria-describedby="p2pool-total-blocks-found-info" [value]="p2poolTotalBlocksFound" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-pplns-weight-info">PPLNS Weight</span>
                <input type="text" class="form-control" aria-label="PPLNS Weight" aria-describedby="p2pool-pplns-weight-info" [value]="p2poolPplnsWeight" readonly>
              </div>

              <div class="input-group mb-1">
                <span class="input-group-text" id="p2pool-pplns-window-size-info">PPLNS Window Size</span>
                <input type="text" class="form-control" aria-label="PPLNS Window Size" aria-describedby="p2pool-pplns-window-size-info" [value]="p2poolPplnsWindowSize" readonly>
              </div>

          </div>

          <div class="col-md-12">
          <div *ngIf="p2poolLines.length === 0" class="h-100 p-5 text-bg-dark rounded-3 mb-4 text-center">
              <h2><i class="bi bi-exclamation-diamond m-4"></i> No logs</h2>
              <p>Start P2Pool mining to enable session logging</p>
            </div>
            
            <div *ngIf="p2poolLogs.length > 0" class="terminal bg-dark text-light p-3 m-4" #logTerminal>
                <div class="terminal-output" id="p2pool-log-table">
{{ p2poolLogs }}
                </div>
            </div>

            <button *ngIf="p2poolLines.length > 0" class="w-100 btn btn-primary btn-lg" type="submit" (click)="clearP2PoolLogs()">Clear</button>
          </div>

        </div>

      </div>
    </div>

  </div>
  
  <div class="tab-pane fade" id="pills-hashrate" role="tabpanel" aria-labelledby="pills-hashrate-tab" tabindex="0">

    <h4 *ngIf="synchronized" class="mb-3">Mining Statistics</h4>

    <div *ngIf="!synchronized" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
      <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
      <div>
        Network hash rate is not available, node is not synchronized
      </div>
    </div>

    <div *ngIf="synchronized" class="row d-flex justify-content-center">
      <div class="col-md-6">
        <h2><i class="bi bi-speedometer m-4"></i>Network Hashrate: {{networkHashRate}}</h2>
        <canvas class="my-4 w-100" id="netHashRateChart" width="900" height="380"></canvas>
      </div>
      
      <div class="col-md-6">
        <h2><i class="bi bi-speedometer m-4"></i>Network Difficulty: {{miningDifficulty}}</h2>
        <canvas class="my-4 w-100" id="netDifficultyChart" width="900" height="380"></canvas>
      </div>

      <div class="col-md-12">
        <h2><i class="bi bi-speedometer m-4"></i>Hashrate: {{miningSpeed}}</h2>
        <canvas class="my-4 w-100" id="hashRateChart" width="900" height="380"></canvas>
      </div>
  
    </div>
  </div>

  <div class="tab-pane fade" id="pills-mining-tools" role="tabpanel" aria-labelledby="pills-mining-tools-tab" tabindex="0">
    <div class="btn-toolbar mb-2 mb-md-0">
      <ul class="nav nav-pills m-3" id="pills-tab" role="tablist">
        
        <li class="nav-item mr-2" role="presentation">
          <button [class]="currentToolsTab === 'generateBlocks' ? 'nav-link active btn-sm' : 'nav-link btn-sm'" id="generateBlocksLink" data-bs-toggle="pill" type="button" role="tab" (click)="setCurrentToolsTab('generateBlocks')">Generate Blocks</button>
        </li>
        
        <li class="nav-item mr-2" role="presentation">
          <button [class]="currentToolsTab === 'getBlockTemplate' ? 'nav-link active btn-sm' : 'nav-link btn-sm'" id="getBlockTemplateLink" data-bs-toggle="pill" type="button" role="tab" (click)="setCurrentToolsTab('getBlockTemplate')">Block Template</button>
        </li>

        <li class="nav-item mr-2" role="presentation">
          <button [class]="currentToolsTab === 'calculatePoW' ? 'nav-link active btn-sm' : 'nav-link btn-sm'" id="calculatePoWLink" data-bs-toggle="pill" type="button" role="tab" (click)="setCurrentToolsTab('calculatePoW')">Calculate PoW</button>
        </li>

        <li class="nav-item mr-2" role="presentation">
          <button [class]="currentToolsTab === 'addAuxPoW' ? 'nav-link active btn-sm' : 'nav-link btn-sm'" id="addAuxPoWLink" data-bs-toggle="pill" type="button" role="tab" (click)="setCurrentToolsTab('addAuxPoW')">Add Aux PoW</button>
        </li>

      </ul>
    </div>

    <div [hidden]="currentToolsTab !== 'generateBlocks'">
      <div *ngIf="generateBlocksError !== ''" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          {{ generateBlocksError }}
        </div>
      </div>

      <div *ngIf="generatingBlocks">
        <!-- Placeholder per il caricamento -->
        <div class="card">
          <div class="card-body">
            <h5 class="card-title placeholder-glow">
              <span class="placeholder col-6"></span>
            </h5>
            <p class="card-text placeholder-glow">
              <span class="placeholder col-7"></span>
              <span class="placeholder col-4"></span>
              <span class="placeholder col-4"></span>
              <span class="placeholder col-6"></span>
              <span class="placeholder col-8"></span>
            </p>
          </div>
        </div>
      </div>
    
      <div *ngIf="generatedBlocks" class="card">
        <div class="card-header bg-success text-white">
          <h4>Generated Blocks</h4>
        </div>
        <div class="card-body">
          <h5 class="card-title">Status: {{ generatedBlocks.status }}</h5>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <strong>Height:</strong> {{ generatedBlocks.height }}
            </li>
            <li class="list-group-item">
              <strong>Untrusted:</strong> {{ generatedBlocks.untrusted ? 'Yes' : 'No' }}
            </li>
            <li class="list-group-item">
              <strong>Blocks:</strong>
              <ul>
                <li *ngFor="let block of generatedBlocks.blocks">{{ block }}</li>
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <hr *ngIf="generatedBlocks" class="my-4">

      <div class="row g-5 p-3">
        <div class="col-md-12 col-lg-12">
          <div class="row gy-3">
            <h4 class="mb-3">Generate a block and specify the address to receive the coinbase reward</h4>
            <div class="col-sm-6">
              <label for="generate-blocks-starting-nonce" class="form-label">Starting Nonce</label>
              <input type="number" min="0" class="form-control" min="0" id="generate-blocks-starting-nonce" placeholder="" [(ngModel)]="generateStartingNonce" [ngModelOptions]="{standalone: true}">
              <small class="text-body-secondary">Increased by miner until it finds a matching result that solves a block</small>
            </div>

            <div class="col-sm-6">
              <label for="generate-blocks-amount-of-blocks" class="form-label">Amount of blocks</label>
              <input type="number" min="0" class="form-control" min="0" id="generate-blocks-amount-of-blocks" placeholder="" [(ngModel)]="generateBlocksAmountOfBlocks" [ngModelOptions]="{standalone: true}">
              <small class="text-body-secondary">Number of blocks to be generated</small>
            </div>

            <div class="col-sm-12">
              <label for="generate-blocks-address" class="form-label">Wallet Address</label>
              <input type="text" class="form-control" id="generate-blocks-address" placeholder="" [(ngModel)]="generateBlocksAddress" [ngModelOptions]="{standalone: true}" required="">
              <small class="text-body-secondary">Address to receive the coinbase reward</small>
            </div>

            <div class="col-sm-12">
              <label for="generate-blocks-prev-block" class="form-label">Prev Block</label>
              <input type="text" class="form-control" id="generate-blocks-prev-block" placeholder="" [(ngModel)]="generateBlockPrevBlock" [ngModelOptions]="{standalone: true}" required="">
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <button *ngIf="!generatingBlocks" class="w-100 btn btn-primary btn-lg" type="button" (click)="generateBlocks()">Generate Blocks</button>
      <button *ngIf="generatingBlocks" class="w-100 btn btn-primary btn-lg" type="button" disabled>Generating Blocks ...</button>
    
    </div>

    <div [hidden]="currentToolsTab !== 'getBlockTemplate'">
      <h4 class="mb-3">Get a block template on which mining a new block</h4>
      <div *ngIf="getBlockTemplateError !== ''" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          {{ getBlockTemplateError }}
        </div>
      </div>

      <div *ngIf="blockTemplate" class="card">
        <div class="card-header bg-dark text-white">
          <h4>Block Template</h4>
        </div>
        <div class="card-body">

          <div class="row">
            <div class="col-md-12">
              <h6>Block Template Blob</h6>
              <p class="text-break bg-dark p-2">{{ blockTemplate.blockTemplateBlob }}</p>
            </div>
          </div>
          
          <div class="row mt-4">
            <div class="col-md-12">
              <h6>Block Header</h6>
              <div class="card">
                <div class="card-body">
                  <ul class="list-group">
                    <li class="list-group-item"><strong>Block Hashing Blob:</strong> {{ blockTemplate.blockHashingBlob }} bytes</li>
                    <li class="list-group-item"><strong>Height:</strong> {{ blockTemplate.height }}</li>
                    <li class="list-group-item"><strong>Previous Hash:</strong> {{ blockTemplate.prevHash }}</li>
                    <li class="list-group-item"><strong>Expected Reward:</strong> {{ blockTemplate.expectedRewardXMR }} XMR</li>
                    <li class="list-group-item"><strong>Difficulty:</strong> {{ blockTemplate.difficulty }}</li>
                    <li class="list-group-item"><strong>Wide Difficulty:</strong> {{ blockTemplate.wideDifficulty }}</li>
                    <li class="list-group-item"><strong>Reserved Offset:</strong> {{ blockTemplate.reservedOffset }}</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <div class="row mt-4">
            <div class="col-md-12">
              <h6>Seed</h6>
              <div class="card">
                <div class="card-body">
                  <ul class="list-group">
                    <li class="list-group-item"><strong>Seed Hash:</strong> {{ blockTemplate.seedHash }}</li>
                    <li class="list-group-item"><strong>Seed Height:</strong> {{ blockTemplate.seedHeight }}</li>
                    <li class="list-group-item"><strong>Next Seed Hash:</strong> {{ blockTemplate.nextSeedHash }}</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <hr *ngIf="blockTemplate" class="my-4">

      <div class="row g-5 p-3">
        <div class="col-md-12 col-lg-12">
          <div class="row gy-3">

            <div class="col-sm-9">
              <label for="get-block-template-address" class="form-label">Address</label>
              <input type="text" class="form-control" id="get-block-template-address" placeholder="" [(ngModel)]="getBlockTemplateAddress" [ngModelOptions]="{standalone: true}" required="">
              <small class="text-body-secondary">Address of wallet to receive coinbase transactions if block is successfully mined</small>
            </div>

            <div class="col-sm-3">
              <label for="get-block-header-reserve-size" class="form-label">Reserve size</label>
              <input type="number" min="0" class="form-control" id="get-block-header-reserve-size" placeholder="" [(ngModel)]="getBlockTemplateReserveSize" [ngModelOptions]="{standalone: true}">
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <button *ngIf="!gettingBlockTemplate" class="w-100 btn btn-primary btn-lg" type="button" (click)="getBlockTemplate()">Get Block Template</button>
      <button *ngIf="gettingBlockTemplate" class="w-100 btn btn-primary btn-lg" type="button" disabled>Getting Block Template ...</button>
    
    </div>

    <div [hidden]="currentToolsTab !== 'calculatePoW'">
      <div *ngIf="calcPowError !== ''" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          {{ calcPowError }}
        </div>
      </div>
      <div *ngIf="calculatedPowHash !== ''" class="alert alert-success d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-check-circle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          Calculated PoW Hash: {{ calculatedPowHash }}
        </div>
      </div>

      <div class="row g-5 p-3">
        <div class="col-md-12 col-lg-12">
          <div class="row gy-3">
            <h4 class="mb-3">Calculate PoW hash for a block candidate</h4>
            <div class="col-sm-6">
              <label for="calc-pow-major-version" class="form-label">Major version</label>
              <input type="number" min="0" class="form-control" min="0" id="calc-pow-major-version" placeholder="" [(ngModel)]="calcPowMajorVersion" [ngModelOptions]="{standalone: true}">
              <small class="text-body-secondary">The major version of the monero protocol at this block height</small>
            </div>

            <div class="col-sm-6">
              <label for="calc-pow-height" class="form-label">Height</label>
              <input type="number" min="0" class="form-control" min="0" id="calc-pow-height" placeholder="" [(ngModel)]="calcPowHeight" [ngModelOptions]="{standalone: true}">
            </div>

            <div class="col-sm-12">
              <label for="calc-pow-blob-data" class="form-label">Blob data</label>
              <textarea [(ngModel)]="calcPowBlobData" [ngModelOptions]="{standalone: true}" type="text" class="form-control" id="calc-pow-blob-data" placeholder="" 
              rows="10" cols="15" ></textarea>
              <div class="invalid-feedback">
                Invalid blob data.
              </div>
          </div>

            <div class="col-sm-12">
              <label for="calc-pow-seed" class="form-label">Seed</label>
              <input type="text" class="form-control" id="calc-pow-seed" placeholder="" [(ngModel)]="calcPowSeed" [ngModelOptions]="{standalone: true}" required="">
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <button *ngIf="!gettingCalcPow" class="w-100 btn btn-primary btn-lg" type="button" (click)="calcPowHash()">Calculate PoW Hash</button>
      <button *ngIf="gettingCalcPow" class="w-100 btn btn-primary btn-lg" type="button" disabled>Calculating PoW Hash ...</button>
    
    </div>

    <div [hidden]="currentToolsTab !== 'addAuxPoW'">
      <div *ngIf="coreBusy" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          Add Aux Pow is not available, node is not synchronized
        </div>
      </div>

      <div *ngIf="addAuxPowError !== ''" class="alert alert-danger d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-exclamation-triangle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          {{ addAuxPowError }}
        </div>
      </div>

      <div *ngIf="addAuxPowSuccess" class="alert alert-success d-flex align-items-center justify-content-center text-center" role="alert">
        <h4><i class="bi bi-check-circle m-2"></i></h4>&nbsp;&nbsp;
        <div>
          Added aux pow
        </div>
      </div>

      <div *ngIf="addAuxPowResult" class="card">
        <div class="card-header bg-dark text-white">
          <h4>Result</h4>
        </div>
        <div class="card-body">
          <!-- Placeholder mentre i dati sono in caricamento -->
          <ng-container>
            <div class="row">
              <div class="col-md-12">
                <h6>Block Template Blob</h6>
                <p class="text-break bg-dark p-2">{{ addAuxPowResult.blockTemplateBlob }}</p>
              </div>
            </div>
            
            <!-- Dettagli del BlockHeader -->
            <div class="row mt-4">
              <div class="col-md-12">
                <!--<h6>Block Header</h6>-->
                <div class="card">
                  <div class="card-body">
                    <ul class="list-group">
                      <li class="list-group-item"><strong>Block Hashing Blob:</strong> {{ addAuxPowResult.blockHashingBlob }} bytes</li>
                      <li class="list-group-item"><strong>Merkle Root:</strong> {{ addAuxPowResult.merkleRoot }} units</li>
                      <li class="list-group-item"><strong>Merkle Three Depth:</strong> {{ addAuxPowResult.merkleTreeDepth }}</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Dettagli del BlockDetails -->
            <div class="row mt-4">
              <div class="col-md-12">
                <h6>Aux PoW</h6>
                <div class="card">
                  <div class="card-body">
                    
                  <table
                    id="auxPowTable"
                    data-toggle="auxPowTable"
                    data-toolbar="#toolbar"
                    data-pagination="true"
                    data-search="true"
                    data-show-columns="true"
                    data-show-columns-search="true"
                    >
                    <thead>
                    <tr>
                        <th data-field="id">ID</th>
                        <th data-field="hash">Hash</th>
                    </tr>
                    </thead>
                  </table>

                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
      
      <hr *ngIf="addAuxPowResult !== undefined" class="my-4">

      <div *ngIf="!coreBusy" class="row g-5 p-3">
        <div class="col-md-12 col-lg-12">
          <div class="row gy-3">
            <h4 class="mb-3">Easily enable merge mining with Monero without requiring software that manually alters the extra field in the coinbase tx to include the merkle root of the aux blocks</h4>

            <div class="col-sm-12">
              <label for="add-aux-pow-block-template-blob" class="form-label">Block Template Blob</label>
              <textarea [(ngModel)]="addAuxPowBlockTemplateBlob" [ngModelOptions]="{standalone: true}" type="text" class="form-control" id="calc-pow-blob-data" placeholder="" 
              rows="10" cols="15" ></textarea>
              <div class="invalid-feedback">
                Invalid blob data.
              </div>
            </div>

            <div class="col-sm-12">
              <label for="add-aux-pow-aux-pow" class="form-label">Aux Pow</label>
              <textarea [(ngModel)]="addAuxPowAuxPowJsonString" [ngModelOptions]="{standalone: true}" type="text" class="form-control" id="add-aux-pow-aux-pow" placeholder="[
    {
    id: <string>
    hash: <string>
    }
    ... ,
    {
      id: <string>
      hash: <string>
    }
  ]
              " 
              rows="10" cols="15" ></textarea>
              <div class="invalid-feedback">
                Invalid blob data.
              </div>
            </div>



          </div>
        </div>
      </div>

      <hr *ngIf="!coreBusy" class="my-4">

      <button *ngIf="!coreBusy && !addingAuxPow" class="w-100 btn btn-primary btn-lg" type="button" (click)="addAuxPow()">Add Aux PoW</button>
      <button *ngIf="!coreBusy && addingAuxPow" class="w-100 btn btn-primary btn-lg" type="button" disabled>Adding Aux PoW ...</button>
    
    </div>

  </div>

</div>

<app-daemon-not-running></app-daemon-not-running>
